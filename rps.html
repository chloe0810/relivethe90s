<!DOCTYPE html>
<html lang="en" ng-app="myApp">
  <head>
  	<title>Game On!</title>
    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-39869790-1', 'github.com');
    ga('send', 'pageview');
  
  </script> 
  
		<style type='text/css'>
			/* MUST HAVE WIDTH/HEIGHT */
			.ace-editor {
			width:100%;
			height:200px;
			}
			#contents {
			width:50%;
			height:50%;
			position:absolute;
			top:0;
			}
		</style>
		<script src="angular.min.js"></script>
		<script src="angular-resource.min.js"></script>
		<script src="jquery.min.js"></script>
		<script src="angular-ace.js"></script>
		<script src="ace.js" type="text/javascript" charset="utf-8"></script>
		<script language="javascript" type="text/javascript">
			angular.module('myApp', ['ngResource','ace']);
			
			function FirstController($scope, $resource){ 
			    $scope.supported_langugages = [
			      {language : 'java', urlName : 'java' },
			      {language : 'js', urlName : 'js' },
			    ];
			
			    $scope.language = 'java';
			
			            //Some example code for each language.
			    $scope.d = {
			                 "js":{"solution":"a=1;\nb=7;",
			                      "tests":"assert_equal(1,a);\nassert_equal(2,b);"},
			                
			                "java":{"solution":"public String nextMove(){\n\treturn \"paper\";\n}",
			                        "tests":"String computerChoice = \"\"; double computer = Math.random(); if (computer < 0.34) {computerChoice = \"rock\";} else if (computer < 0.67){computerChoice = \"paper\";} else {computerChoice = \"scissors\";} String userChoice = nextMove(); assertEquals(computerChoice, userChoice); ",
			                }
			        },
			
			
			    $scope.status = "Ready"
			    //Load some good code
			    $scope.load_example_code = function(){
			      $scope.solution = $scope.d[$scope.language]["solution"];
			      $scope.tests = $scope.d[$scope.language]["tests"];
			    };
			
			
			    // For the loadbalancer version with fewer options. 
			    $scope.VerifierModel = $resource('http://ec2-54-251-193-188.ap-southeast-1.compute.amazonaws.com/:language',
			                            {},{'get': {method: 'JSONP', isArray: false, params:{vcallback: 'JSON_CALLBACK'}}
			                               }
			                        );
			
			    $scope.verify = function(){
			      data = {solution: $scope.solution, tests: $scope.tests}
			      jsonrequest = btoa(JSON.stringify(data));
			
			      $scope.status = "Verifying"
			      $scope.VerifierModel.get({'language':$scope.language,
			                                'jsonrequest':jsonrequest},
			          
			         
			            function(response) { 
			              $scope.result = response;
			              var arr = response["results"];
			              var tie = response.solved;
			              var computerChoice ="";
			              var userChoice ="";
			              if (!tie){
			                computerChoice = arr[0].expected[1];
			                userChoice = arr[0].received.charAt(3);
			              }

			              $scope.status = "Ready";
			              getWinner(tie, computerChoice, userChoice);

			            });
			
			            
			            function getWinner(tie, computerChoice, userChoice){
			              
			              if (!tie){
			              if (userChoice === "r"){
			                $scope.userMove = "rock";
			              }else if (userChoice === "p"){
			                $scope.userMove = "paper";
			              }else if (userChoice === "s"){
			                $scope.userMove = "scissors";
			              }
			              
			              if (computerChoice === "r"){
			                $scope.computerMove = "rock";
			              }else if (computerChoice === "p"){
			                $scope.computerMove = "paper";
			              }else if (computerChoice === "s"){
			                $scope.computerMove = "scissors";
			              }
			              } 
			              
			              var msg = "";
			      
			      if (tie===true||tie.toString==="true"){
			        msg = "Its a tie!";
			      }
			      else if (userChoice != "r" && userChoice != "p" && 
			        userChoice != "s"){
			          msg = "invalid move!";
			      }
			      
			      else if (computerChoice === "r"){
			        if (userChoice === "p"){
			          msg = "paper wins";
			      	}else {
			      		msg = "rock wins";
			      	}
			      }
			      
			      else if (computerChoice === "p"){
			      	if (userChoice === "r"){
			      		msg = "paper wins";
			      	}else {
			      		msg = "scissors wins";
			      	}
			      }
			      
			      else if (computerChoice === "s"){
			      	if (userChoice === "p"){
			      		msg = "scissors wins";
			      	}else {
			      		msg = "rock wins";
			      	}
			      } 
			      
			      $scope.winner = msg;
			            }
			            
			    };

			  }
		</script>
	</head>
	<body ng-controller="FirstController">
		<select ng-model="language" ng:change="load_example_code()" ng-options="item.language as item.urlName for item in supported_langugages"></select>
		<br>
		<input type="submit" value="verify {{language}} code" ng-click="verify()">
		<br>
		Status: {{status}}<br>
		Result: 
		<pre>{{result}}</pre>
		<br>
		WINNER: {{winner}}</br>
		Is Tie: <b>{{result.solved}}</b><br>
		<table border=1 bgcolor=#FFFFFF>
			<tr>
				<th>Computer</th>
				<th>Player</th>
			</tr>
			<tr>
				<td>{{computerMove}}</td>
				<td>{{userMove}}</td>
			</tr>
		</table>
		Player Solution:
		<div>
			<textarea ng-model="solution" name="solution" rows="8" cols="50"></textarea>
		</div>
		Tests:
		<div >
			<textarea ng-model="tests" name="tests" rows="8" cols="50"></textarea>
		</div>
		<span ng-init="load_example_code()"></span>
	</body>
</html>
